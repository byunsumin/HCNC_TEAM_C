<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="Form_Login" width="720" height="350" titletext="로그인">
    <Layouts>
      <Layout width="720" height="350">
        <Static id="lbl_user_id" text="아이디" left="203" top="182" width="100" height="30" taborder="0"/>
        <Edit id="edt_user_id" left="303" top="182" width="200" height="30" taborder="1" binddataset="ds_login" bindcolumn="user_id" onchanged="edt_user_id_onchanged"/>
        <Static id="lbl_password" text="비밀번호" left="203" top="227" width="100" height="30" taborder="2"/>
        <Edit id="edt_password" left="303" top="227" width="200" height="30" password="true" taborder="3" binddataset="ds_login" bindcolumn="password"/>
        <Button id="btn_login" text="로그인" left="333" top="267" width="100" height="40" taborder="4" onclick="fnLogin_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_login" type="normal">
        <ColumnInfo>
          <Column id="user_id" type="STRING" size="256"/>
          <Column id="password" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="user_id"/>
            <Col id="password"/>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript5.1"><![CDATA[this.fnLoginCallback = function(strSvcId, nErrorCode, strErrorMsg) {
	objApp=nexacro.getApplication();
    if (nErrorCode < 0) {
        alert("로그인 실패: " + strErrorMsg);
    }
    else {
        // 서버에서 반환한 ds_userInfo에서 각 정보 가져옴
		//console.log(this.ds_userInfo.saveXML());
//         var userId = this.ds_login.getColumn(0, "id");
//         var password = this.ds_login.getColumn(0, "password");
//         var adminName = this.ds_login.getColumn(0, "name");
//         var email = this.ds_login.getColumn(0, "email");
		
// 		console.log(this.ds_login.saveXML());
// 		console.log("userId: " + userId);
// 		console.log("password: " + password);
// 		console.log("name: " + name);
// 		console.log("email: " + email);
        
		// 전역 데이터셋에 저장
        var row = objApp.ds_userInfo.addRow();
		var row2 = objApp.ds_userInfo.rowposition;
		console.log("#####");
		console.log(objApp.ds_userInfo.rowcount); // 2
		console.log(objApp.ds_userInfo.rowposition); // 1
		console.log("#####");

//         nexacro.getApplication().ds_userInfo.setColumn(row, "id", user_id);
//         nexacro.getApplication().ds_userInfo.setColumn(row, "password", password);
//         nexacro.getApplication().ds_userInfo.setColumn(row, "name", name);
//         nexacro.getApplication().ds_userInfo.setColumn(row, "email", email);
		
		// 저장된 값 확인하는 콘솔 로그
		console.log("저장된 ID: " + objApp.ds_userInfo.getColumn(row, "id"));
		console.log("저장된 Password: " + objApp.ds_userInfo.getColumn(row, "password"));
		console.log("저장된 Name: " + objApp.ds_userInfo.getColumn(row, "name"));
		console.log("저장된 Email: " + objApp.ds_userInfo.getColumn(row, "email"));
		console.log(nexacro.getApplication().ds_userInfo.saveXML());
		console.log(nexacro.getApplication().ds_userInfo.getColumn(row,"name"));

        alert("로그인 성공! 사용자 정보가 저장되었습니다.");
        
        // 로그인 성공 후 페이지 이동
        nexacro.getApplication().mainframe.VFrameSet00.HFrameSet00.WorkFrame.set_formurl("FrameBase::Form_Post.xfdl");
    }
};


this.fnLogin_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	
	
    // ds_login에서 user_id와 password 값을 가져옴
    var user_id = this.ds_login.getColumn(0,"user_id"); // "emp_code" 대신 "user_id"를 사용
    var password = this.ds_login.getColumn(0,"password"); // Dataset에서 password 값을 가져옴
    
    // Dataset에 Row가 제대로 있는지 확인
    console.log("Dataset row count: " + this.ds_login.getRowCount()); // Row 개수를 확인
    
    // 데이터가 제대로 입력되었는지 로그로 출력
    console.log("id: " + user_id);
    console.log("password: " + password);

    // 아이디와 비밀번호가 비어있으면 경고 메시지 출력
    if(user_id == "" ||user_id =='undefined'|| user_id== null||password == "")
    {
        alert("아이디를 입력해 주세요");
        return;
    }
    
    // 로그인 함수 호출
    this.fnLogin();
};


this.fnLogin = function() {
    console.log("함수 안에 들어옴");
	console.log(this.ds_login.saveXML());  // DataSet 내용 확인
    
    var strSvcId = "loginService";
    var strSvcUrl = "svc::login.do";
    var inData = "ds_login=ds_login";
    var outData = "nexacro.getApplication().ds_userInfo=ds_login";  // 서버로부터 받아온 데이터를 받을 데이터셋
    var strArg = "";
    var callBackFnc = "fnLoginCallback";  // 콜백 함수
    var isAsync = true;
    
    this.transaction(strSvcId, strSvcUrl, inData, outData, strArg, callBackFnc, isAsync);
    console.log("transaction 지나감");
};

]]></Script>
    <Bind>
      <BindItem id="item0" compid="edt_user_id" propid="value" datasetid="ds_login" columnid="user_id"/>
      <BindItem id="item1" compid="edt_password" propid="value" datasetid="ds_login" columnid="password"/>
    </Bind>
  </Form>
</FDL>
