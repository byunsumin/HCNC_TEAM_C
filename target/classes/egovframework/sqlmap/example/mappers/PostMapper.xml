<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="hcnc.cteam.post.PostMapper">
    <!-- 게시글 목록 조회 -->
    <select id="selectPost" parameterType="map" resultType="map">
	    SELECT a.post_code, a.title, a.content, a.reg_date, b.name AS emp_name, a.view_count
	    	FROM post a
	    INNER JOIN employee b 
	      ON a.emp_code = b.emp_code
	</select>
	<!-- 게시글 상세 조회 관련 쿼리 -->	
	<select id="selectPostDetail" parameterType="int" resultType="map">
	    SELECT a.post_code, a.title, a.content, a.reg_date, name, a.view_count
	    	FROM post a
	    INNER JOIN employee b 
	      ON a.emp_code = b.emp_code
	    WHERE post_code = #{postCode}
	</select>	
	<!-- 조회수 1 증가 관련 -->
	<update id ="increaseViewCount" parameterType="int">
		UPDATE post
			SET view_count =view_count +1
		WHERE post_code =#{post_code}
	</update>
	<!-- 글 등록 관련 -->
	<insert id="insertPost" parameterType="map" useGeneratedKeys="true" keyProperty="post_code">
	    INSERT INTO post (
	        emp_code, title, content, view_count,
	        reg_date, reg_name, upd_date, upd_name
	    ) VALUES (
	        #{emp_code}, #{title}, #{content}, 0,
	        NOW(), #{upd_name}, NOW(), #{upd_name}
	    )
	    <!-- 자동 생성된 키 가져오기 -->
    <selectKey resultType="int" keyProperty="post_code" order="AFTER">
        SELECT LAST_INSERT_ID()
    </selectKey>
	</insert>
	<!-- 첨부파일 등록 -->
	<insert id="insertAttachment" parameterType="map">
	    INSERT INTO attachment (
	        post_code, emp_code, attach_name, attach_url,
	        reg_date, reg_name, upd_date, upd_name
	    ) VALUES (
	        #{post_code}, #{emp_code}, #{attach_name}, #{attach_url},
	        NOW(), #{reg_name}, NOW(), #{upd_name}
	    );
	</insert>

	
</mapper>

