<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hcnc.cteam.attendance.NexaAttenMapper">

	<!-- 조건에 따른 조회(검색) 쿼리 -->
	<select id="nexaGetAttenListByCondition"
		resultType="nexaAttenDTO">
		SELECT a.emp_code as empCode, b.name as name, a.work_date as
		workDate, c.atten_type as attenType, a.work_start as workStart
		, a.work_end as workEnd, a.work_over as workOver
		FROM attendance a
		JOIN employee b ON a.emp_code = b.emp_code
		JOIN att_code c ON a.atten_code = c.atten_code
		WHERE 1=1
		<if test="SEARCH_WORD != null and SEARCH_WORD != '' and SEARCH_TYPE != '' and SEARCH_TYPE != null">
			<!-- 전체 조회 -->
			<if test="SEARCH_TYPE == 'ALL'">
				AND (a.emp_code LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR b.name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR a.work_date LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR c.atten_type LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR a.work_start LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR a.work_end LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR a.work_over LIKE CONCAT('%', #{SEARCH_WORD}, '%'))
			</if>
			<!-- 이름별 조회 -->
			<if test="SEARCH_TYPE == 'NAME'">
				AND b.name LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<!-- 근무형태별 조회 -->
			<if test="SEARCH_TYPE == 'WORK_TYPE'">
				AND c.atten_type LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
		</if>
		<!-- 근무일자에 따른 조회 -->
		<if test="START_DATE != null and END_DATE != null">
			AND a.work_date BETWEEN #{START_DATE} AND #{END_DATE}
		</if>
	</select>

</mapper>