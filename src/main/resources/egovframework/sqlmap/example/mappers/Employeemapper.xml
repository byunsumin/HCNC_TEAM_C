<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hcnc.cteam.employee.EmployeeMapper">

    <!-- 모든 직원 목록 조회 -->
    <select id="getAllEmployees" resultType="hcnc.cteam.employee.employeeDTO">
        SELECT
            a.emp_code AS empCode,
            b.dep_name AS depName,
            a.name,
            a.join_date AS joinDate,
            a.birth,
            a.gender,
            a.phone,
            a.address,
            a.email
        FROM employee a
        JOIN department b ON a.dep_code = b.dep_code
    </select>
    
    <!-- 직원 코드로 직원 조회 (여기만 남겨두세요) -->
    <select id="getEmployeeByEmpCode" parameterType="int" resultType="hcnc.cteam.employee.employeeDTO">
        SELECT
            a.emp_code AS empCode,
            b.dep_name AS depName,
            c.assign_name AS assignName,
            a.name,
            a.join_date AS joinDate,
            a.birth,
            a.gender,
            a.phone,
            a.address,
            a.email
        FROM employee a
        JOIN department b ON a.dep_code = b.dep_code
        JOIN assignment c ON a.assign_code = c.assign_code
        WHERE a.emp_code = #{empCode}
    </select>

    <!-- 조건에 따른 직원 목록 검색 -->
    <select id="getEmployeeListByCondition"
        parameterType="map"
        resultType="hcnc.cteam.employee.employeeDTO">
        SELECT
            a.emp_code AS empCode,
            b.dep_name AS depName,
            c.assign_name AS assignName,
            a.name,
            a.join_date AS joinDate,
            a.birth,
            a.gender,
            a.phone,
            a.address,
            a.email
        FROM employee a
        JOIN department b ON a.dep_code = b.dep_code
        JOIN assignment c ON a.assign_code = c.assign_code

        WHERE 1=1
        <if test="searchType != null and searchWord != null">
            <choose>
                <when test="searchType == 'depName'">
                    AND b.dep_name LIKE CONCAT('%', #{searchWord}, '%')
                </when>
                <when test="searchType == 'name'">
                    AND a.name LIKE CONCAT('%', #{searchWord}, '%')
                </when>
                <when test="searchType == 'address'">
                    AND a.address LIKE CONCAT('%', #{searchWord}, '%')
                </when>
            </choose>
        </if>
    </select>

</mapper>
